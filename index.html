<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>蒙特利尔餐厅地图</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #root {
            width: 100vw;
            height: 100vh;
        }
    </style>
    <script src="https://unpkg.com/react@16.8.6/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16.8.6/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/redux@3.7.2/dist/redux.min.js"></script>
    <script src="https://unpkg.com/react-redux@7.1.3/dist/react-redux.min.js"></script>
    <script src="https://unpkg.com/kepler.gl/umd/keplergl.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script>
        const mapboxToken = 'pk.eyJIIjoibmlja3l1IiwiYSI6ImNsc2F1Y2F1YjE0Y2UyanA5Y2F1Y2F1YjE0Y2UifQ.u7hC26alykUtIToIcKF5Cw';
        const reducers = window.combineReducers({
            keplerGl: window.KeplerGl.keplerGlReducer
        });

        const store = window.Redux.createStore(reducers);
        const App = window.React.memo((props) => {
            return window.React.createElement(window.ReactRedux.Provider, { store },
                window.React.createElement(window.KeplerGl.KeplerGl, {
                    id: 'map',
                    mapboxApiAccessToken: mapboxToken,
                    width: window.innerWidth,
                    height: window.innerHeight
                })
            );
        });

        window.ReactDOM.render(
            window.React.createElement(App),
            document.getElementById('root')
        );

        // 加载数据
        async function loadData() {
            try {
                const response = await fetch('yelp_montreal_restaurants_detailed_with_geotag.csv');
                const data = await response.text();
                
                const datasets = {
                    info: {
                        label: '蒙特利尔餐厅',
                        id: 'restaurants'
                    },
                    data: data
                };

                const addDataToMapAction = window.KeplerGl.addDataToMap({
                    datasets: [datasets],
                    options: {
                        centerMap: true,
                        readOnly: true
                    },
                    config: {}
                });

                store.dispatch(addDataToMapAction);
            } catch (error) {
                console.error('加载数据失败:', error);
                document.getElementById('root').innerHTML = `
                    <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:red;text-align:center;">
                        <h3>加载失败</h3>
                        <p>错误信息: ${error.message}</p>
                    </div>
                `;
            }
        }

        // 页面加载完成后加载数据
        window.addEventListener('load', loadData);
    </script>
</body>
</html> 